---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const categoryCounts = new Map<string, number>();

posts.forEach((post) => {
  post.data.categories.forEach((cat) => {
    categoryCounts.set(cat, (categoryCounts.get(cat) ?? 0) + 1);
  });
});

const sortedCategories = [...categoryCounts.entries()].sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Categories">
  <div class="max-w-4xl mx-auto px-4 py-16">
    <h1 class="text-4xl font-extrabold mb-10">
      <span class="bg-gradient-to-r from-indigo-500 to-purple-500 bg-clip-text text-transparent">Categories</span>
    </h1>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      {sortedCategories.map(([category, count]) => (
        <a
          href={`/categories/${category.toLowerCase()}`}
          class="group flex items-center justify-between p-5 rounded-2xl bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 hover:border-indigo-300 dark:hover:border-indigo-700 hover:shadow-lg transition-all duration-300"
        >
          <span class="text-lg font-semibold group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
            {category}
          </span>
          <span class="text-sm font-medium px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400 group-hover:bg-indigo-100 dark:group-hover:bg-indigo-900/30 group-hover:text-indigo-600 dark:group-hover:text-indigo-300 transition-colors">
            {count} post{count !== 1 ? 's' : ''}
          </span>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
